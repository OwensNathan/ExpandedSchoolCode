@inject CombinationOfSchoolCode.Shared.GameEngine Engine

<h3>Pick A Path - The Enchanted Forest</h3>

@if (currentNode == "start")
{
    <div>
        <h4>ğŸŒ² Welcome, Adventurer! ğŸŒ²</h4>
        <p>You stand at the edge of an ancient enchanted forest. The trees tower above you, their branches swaying mysteriously in the wind. You've heard tales of a legendary treasure hidden deep within, but also of the dangers that lurk in the shadows.</p>
        <p>Before you are three paths:</p>
        <button @onclick='() => MakeChoice("path_left")' class="choice-btn">Take the left path (looks well-traveled)</button>
        <button @onclick='() => MakeChoice("path_center")' class="choice-btn">Take the center path (darker and mysterious)</button>
        <button @onclick='() => MakeChoice("path_right")' class="choice-btn">Take the right path (sunlight filters through)</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "path_left")
{
    <div>
        <h4>ğŸ›¤ï¸ The Well-Traveled Path</h4>
        <p>You follow the left path. The ground is worn smooth by countless footsteps. After a short walk, you encounter an old merchant sitting beside a campfire.</p>
        <p>"Greetings, traveler!" he says. "I have a magical compass that always points to treasure. I'll trade it for 50 gold coins, or you can try your luck without it."</p>
        <button @onclick='() => MakeChoice("buy_compass")' class="choice-btn">Buy the compass (you have exactly 50 gold)</button>
        <button @onclick='() => MakeChoice("decline_merchant")' class="choice-btn">Politely decline and continue</button>
        <button @onclick='() => MakeChoice("rob_merchant")' class="choice-btn">Attempt to rob the merchant</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "path_center")
{
    <div>
        <h4>ğŸŒ‘ The Dark Path</h4>
        <p>The center path grows darker as you venture deeper. Strange whispers echo around you. Suddenly, you see glowing eyes in the shadowsâ€”a dire wolf blocks your path!</p>
        <p>The wolf growls menacingly. What do you do?</p>
        <button @onclick='() => MakeChoice("fight_wolf")' class="choice-btn">Fight the wolf with your sword</button>
        <button @onclick='() => MakeChoice("befriend_wolf")' class="choice-btn">Try to befriend the wolf with food</button>
        <button @onclick='() => MakeChoice("run_from_wolf")' class="choice-btn">Run away quickly</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "path_right")
{
    <div>
        <h4>â˜€ï¸ The Sunlit Path</h4>
        <p>The right path is pleasant and warm. Sunlight dances through the leaves. You come across a beautiful clearing with a crystal-clear pond.</p>
        <p>In the center of the pond, you see something shimmering beneath the water. A sign reads: "Only the pure of heart may claim the prize."</p>
        <button @onclick='() => MakeChoice("swim_pond")' class="choice-btn">Swim to the center of the pond</button>
        <button @onclick='() => MakeChoice("walk_around_pond")' class="choice-btn">Walk around the pond and continue</button>
        <button @onclick='() => MakeChoice("drink_water")' class="choice-btn">Drink from the pond first</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "buy_compass")
{
    <div>
        <h4>ğŸ§­ The Magical Compass</h4>
        <p>You trade your gold for the compass. It immediately spins and points deeper into the forest. Following it carefully, you navigate through dangerous areas safely.</p>
        <p>The compass leads you to a hidden cave. Inside, you find the legendary treasure chest!</p>
        <p><strong>ğŸ† Victory! You found the treasure!</strong></p>
        <p>The compass was worth every coin. You return home a wealthy adventurer!</p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "decline_merchant")
{
    <div>
        <h4>ğŸ—ºï¸ Going Alone</h4>
        <p>You thank the merchant and continue on your own. The path splits again into two trails. One leads uphill, the other downhill.</p>
        <button @onclick='() => MakeChoice("uphill")' class="choice-btn">Take the uphill trail</button>
        <button @onclick='() => MakeChoice("downhill")' class="choice-btn">Take the downhill trail</button>
        <button @onclick='() => MakeChoice("follow_stream")' class="choice-btn">Follow a nearby stream</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "rob_merchant")
{
    <div>
        <h4>âš”ï¸ Bad Decision</h4>
        <p>You attempt to rob the merchant, but he's actually a powerful wizard in disguise!</p>
        <p>"Foolish mortal!" he thunders, and with a wave of his staff, you're turned into a frog.</p>
        <p><strong>ğŸ’€ Game Over! You spent the rest of your days as a frog by the merchant's campfire.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "fight_wolf")
{
    <div>
        <h4>âš”ï¸ The Battle</h4>
        <p>You draw your sword and face the dire wolf. The battle is fierce! You manage to wound the wolf, but it's stronger than you expected.</p>
        <p>With a final lunge, the wolf overpowers you.</p>
        <p><strong>ğŸ’€ Game Over! The dire wolf was too powerful.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "befriend_wolf")
{
    <div>
        <h4>ğŸº A Loyal Companion</h4>
        <p>You slowly offer the wolf some dried meat from your pack. The wolf sniffs cautiously, then accepts your offering.</p>
        <p>The wolf's eyes soften, and it begins to wag its tail. It becomes your loyal companion!</p>
        <p>Together, you explore deeper into the forest. The wolf's keen senses lead you safely past traps and dangers, eventually finding a secret grove where the treasure lies!</p>
        <p><strong>ğŸ† Victory! With your new companion's help, you found the treasure!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "run_from_wolf")
{
    <div>
        <h4>ğŸƒ Retreat!</h4>
        <p>You turn and run as fast as you can! The wolf chases you briefly but gives up. You keep running until you can't hear it anymore.</p>
        <p>When you stop to catch your breath, you realize you've run straight into a different part of the forest. You see sunlight filtering through trees aheadâ€”it looks like the right path's sunlit clearing!</p>
        <button @onclick='() => MakeChoice("reach_pond_tired")' class="choice-btn">Head toward the sunlight</button>
        <button @onclick='() => MakeChoice("rest_and_regroup")' class="choice-btn">Rest here and plan your next move</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "reach_pond_tired")
{
    <div>
        <h4>â˜€ï¸ The Familiar Pond</h4>
        <p>You emerge at the crystal-clear pond you would have found on the right path. But you're exhausted from running and your judgment is clouded.</p>
        <p>In your desperate state, you forget to read the sign and rush into the water without thinking.</p>
        <button @onclick='() => MakeChoice("swim_pond")' class="choice-btn">Swim to the center (you need that prize!)</button>
        <button @onclick='() => MakeChoice("rest_by_pond")' class="choice-btn">Rest by the pond first</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "rest_and_regroup")
{
    <div>
        <h4>ğŸ§˜ Moment of Clarity</h4>
        <p>You sit down and take deep breaths, letting your racing heart slow down. As you rest, you notice something interestingâ€”ancient carved symbols on nearby trees.</p>
        <p>These symbols form a trail! Someone long ago marked a path through the forest. You have enough energy to follow them now.</p>
        <button @onclick='() => MakeChoice("follow_symbols")' class="choice-btn">Follow the ancient symbols</button>
        <button @onclick='() => MakeChoice("ignore_symbols")' class="choice-btn">Ignore them and find your own way</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "rest_by_pond")
{
    <div>
        <h4>ğŸ’­ Renewed Spirit</h4>
        <p>You rest by the pond, drinking carefully from your waterskin. As your exhaustion fades, you notice the sign: "Only the pure of heart may claim the prize."</p>
        <p>Now that you're thinking clearly, you remember reading about this pond in old legends. The test isn't about swimmingâ€”it's about respect and patience.</p>
        <p>You meditate by the water's edge, and the pond itself responds to your pure intentions, rising up to present you with the magical crystal!</p>
        <p><strong>ğŸ† Victory! Patience and respect earned the pond's blessing!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "follow_symbols")
{
    <div>
        <h4>ğŸ—¿ The Ancient Path</h4>
        <p>You follow the carved symbols from tree to tree. They lead you through safe passages, around hidden dangers, and finally to a stone monument.</p>
        <p>At the monument, you find an inscription: "The treasure seeks those who follow wisdom." Behind the monument lies a hidden stairway leading underground.</p>
        <p>You descend and find the treasure chamber, untouched for centuries!</p>
        <p><strong>ğŸ† Victory! The ancient ones guided you true!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "ignore_symbols")
{
    <div>
        <h4>ğŸŒ² Lost in the Woods</h4>
        <p>You decide to trust your own instincts instead of following mysterious symbols. However, without a clear direction, you soon become hopelessly lost.</p>
        <p>After wandering for hours in circles, you finally find a path that leads you out of the forest, but the treasure remains hidden.</p>
        <p><strong>ğŸ˜ Loss: Pride led you astray from the treasure's path.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "swim_pond")
{
    <div>
        <h4>ğŸ’ The Crystal Prize</h4>
        <p>You wade into the pond and swim to the center. The water is refreshing and pure. As you reach the shimmering object, you find it's a magical crystal!</p>
        <p>The crystal glows with inner light and grants you the vision to see hidden paths. Using this gift, you easily navigate to the treasure's location!</p>
        <p><strong>ğŸ† Victory! The pure waters rewarded your brave heart!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "walk_around_pond")
{
    <div>
        <h4>ğŸš¶ The Long Way</h4>
        <p>You decide not to disturb the pond and walk around it. The path continues through pleasant forest, and you come across several interesting locations.</p>
        <p>To your left, you see smoke risingâ€”perhaps a cabin. Straight ahead, the forest grows darker. To your right, you hear what sounds like a waterfall. Behind you, you notice a mystical glade glowing faintly.</p>
        <button @onclick='() => MakeChoice("investigate_cabin")' class="choice-btn">Head toward the smoke</button>
        <button @onclick='() => MakeChoice("dark_forest_ahead")' class="choice-btn">Continue into the darker forest</button>
        <button @onclick='() => MakeChoice("find_waterfall")' class="choice-btn">Follow the sound of the waterfall</button>
        <button @onclick='() => MakeChoice("mystical_glade")' class="choice-btn">Explore the mystical glade</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "investigate_cabin")
{
    <div>
        <h4>ğŸ  The Hermit's Home</h4>
        <p>You approach a small cabin. An old hermit sits on the porch, carving wood. He looks up and smiles warmly.</p>
        <p>"Lost traveler, are you?" he asks. "I've lived in these woods for fifty years. The treasure you seek isn't far. I can tell you the way... for a price."</p>
        <button @onclick='() => MakeChoice("pay_hermit")' class="choice-btn">Offer him your remaining gold</button>
        <button @onclick='() => MakeChoice("ask_riddle")' class="choice-btn">Ask if you can earn the information</button>
        <button @onclick='() => MakeChoice("decline_hermit")' class="choice-btn">Thank him and continue alone</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "dark_forest_ahead")
{
    <div>
        <h4>ğŸŒ‘ Twilight Path</h4>
        <p>The forest grows darker and more foreboding. Ancient trees loom overhead, blocking out the sun. You feel like you're being watched.</p>
        <p>Suddenly, you hear a familiar growlâ€”the dire wolf! But this time, it's surrounded by a pack. You realize you've wandered into their territory.</p>
        <p><strong>ğŸ’€ Game Over! The wolf pack was too much to handle alone.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "find_waterfall")
{
    <div>
        <h4>ğŸ’§ Cascading Waters</h4>
        <p>You find a beautiful waterfall cascading down mossy rocks. The mist creates tiny rainbows in the air. Behind the waterfall, you notice a cave entrance!</p>
        <button @onclick='() => MakeChoice("behind_waterfall")' class="choice-btn">Go behind the waterfall</button>
        <button @onclick='() => MakeChoice("climb_waterfall")' class="choice-btn">Climb up beside the waterfall</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "pay_hermit")
{
    <div>
        <h4>ğŸ’° The Deal</h4>
        <p>You give the hermit your remaining gold. He nods appreciatively and provides you with detailed directions and a hand-drawn map.</p>
        <p>"Follow this path exactly," he says. "Don't deviate even a single step."</p>
        <p>Following his instructions precisely, you navigate through hidden passages and arrive at the treasure's location within hours!</p>
        <p><strong>ğŸ† Victory! The hermit's knowledge was worth every coin!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "ask_riddle")
{
    <div>
        <h4>ğŸ­ The Riddle Challenge</h4>
        <p>The hermit's eyes twinkle. "A seeker of knowledge! Very well. Answer my riddle correctly, and I'll guide you freely."</p>
        <p>"I speak without a mouth and hear without ears. I have no body, but I come alive with wind. What am I?"</p>
        <button @onclick='() => MakeChoice("answer_echo")' class="choice-btn">An echo</button>
        <button @onclick='() => MakeChoice("answer_wind")' class="choice-btn">The wind</button>
        <button @onclick='() => MakeChoice("answer_voice")' class="choice-btn">A voice</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "decline_hermit")
{
    <div>
        <h4>ğŸ’ Independent Journey</h4>
        <p>You thank the hermit but decide to continue on your own path. He shrugs and returns to his carving.</p>
        <p>You wander for hours, and eventually the sun begins to set. Without guidance, you realize you're no closer to the treasure and decide to head home.</p>
        <p><strong>ğŸ˜ Loss: Sometimes accepting help is the wiser choice.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "behind_waterfall")
{
    <div>
        <h4>âœ¨ Secret Sanctuary</h4>
        <p>You carefully make your way behind the waterfall. The cave is beautiful, with glowing mushrooms providing soft light.</p>
        <p>In the center of the cave, protected by the waterfall for centuries, sits the legendary treasure on a stone pedestal!</p>
        <p><strong>ğŸ† Victory! The waterfall hid the greatest secret!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "climb_waterfall")
{
    <div>
        <h4>ğŸ§— The Climb</h4>
        <p>You attempt to climb the slippery rocks beside the waterfall. The moss makes it incredibly difficult.</p>
        <p>Your hand slips on a wet rock, and you fall into the pool below. The current is stronger than expected and pulls you downstream.</p>
        <p>You survive but are swept far from the treasure's location, exhausted and defeated.</p>
        <p><strong>ğŸ˜ Loss: The waterfall's power was too great.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_echo")
{
    <div>
        <h4>ğŸ‰ Correct Answer!</h4>
        <p>"Well done!" the hermit exclaims. "You have wisdom beyond your years. An echo indeed!"</p>
        <p>True to his word, he provides you with excellent directions. He even gives you a special token that will help you past the final guardian.</p>
        <p>With his help, you successfully navigate to the treasure and claim it!</p>
        <p><strong>ğŸ† Victory! Wisdom opened the path to fortune!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_wind")
{
    <div>
        <h4>âŒ Wrong Answer</h4>
        <p>"No, no," the hermit shakes his head. "The wind has a body of sortsâ€”moving air. Think again, but I can only give one chance."</p>
        <p>Disappointed, you continue without his help. You wander but never find the treasure.</p>
        <p><strong>ğŸ˜ Loss: The riddle stumped you.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_voice")
{
    <div>
        <h4>âŒ Not Quite</h4>
        <p>"A voice requires a mouth," the hermit says gently. "Close, but not correct. I cannot help you now."</p>
        <p>You thank him and move on, but without guidance, the treasure remains elusive.</p>
        <p><strong>ğŸ˜ Loss: So close, yet so far.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "drink_water")
{
    <div>
        <h4>ğŸ§ª Poisoned!</h4>
        <p>You kneel and drink from the pond. The water tastes sweet at first, but then you feel dizzy.</p>
        <p>The sign said "pure of heart" - but drinking was a test of greed! The water was enchanted to reveal those who would take without permission.</p>
        <p><strong>ğŸ’€ Game Over! The enchanted water was not meant for drinking.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "uphill")
{
    <div>
        <h4>â›°ï¸ Mountain Peak</h4>
        <p>You climb the steep uphill path. It's exhausting, but at the top, you find a magnificent view. From here, you spot smoke rising from a hidden valley belowâ€”a sign of civilization!</p>
        <p>You descend and find a village of forest dwellers. They've been guarding the treasure for generations and, impressed by your perseverance in climbing the mountain, they grant you access to it!</p>
        <p><strong>ğŸ† Victory! Your determination was rewarded!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "downhill")
{
    <div>
        <h4>ğŸ•³ï¸ The Ravine</h4>
        <p>You take the easier downhill path. It leads to a deep ravine with a rickety rope bridge.</p>
        <p>The bridge looks dangerous but it's the only way across. You notice some vines along the cliff wall that might provide an alternative route.</p>
        <button @onclick='() => MakeChoice("cross_bridge")' class="choice-btn">Carefully cross the bridge</button>
        <button @onclick='() => MakeChoice("climb_vines")' class="choice-btn">Climb down using the vines</button>
        <button @onclick='() => MakeChoice("explore_ravine")' class="choice-btn">Explore along the ravine edge</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "follow_stream")
{
    <div>
        <h4>ğŸŒŠ The Flowing Stream</h4>
        <p>You follow the gentle stream through the forest. The water sparkles in the dappled sunlight. After a while, you hear voices ahead.</p>
        <p>You peek through the bushes and see a group of travelers setting up camp. They seem friendly, but you're cautious.</p>
        <button @onclick='() => MakeChoice("join_travelers")' class="choice-btn">Approach and greet the travelers</button>
        <button @onclick='() => MakeChoice("sneak_past")' class="choice-btn">Quietly sneak past them</button>
        <button @onclick='() => MakeChoice("observe_travelers")' class="choice-btn">Hide and observe them first</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "cross_bridge")
{
    <div>
        <h4>ğŸŒ‰ Brave Crossing</h4>
        <p>You test the bridge carefully with your weight. The wood creaks ominously but holds. Step by step, you make your way across.</p>
        <p>Just as you reach the other side, a plank breaks behind you! You made it safely, though your heart is racing.</p>
        <p>On the other side, you find an old trail marker with multiple arrows pointing toward "Crystal Caves", "Ancient Ruins", "Enchanted Bridge", and "Mysterious Cave".</p>
        <button @onclick='() => MakeChoice("crystal_caves")' class="choice-btn">Head to the Crystal Caves</button>
        <button @onclick='() => MakeChoice("ancient_ruins")' class="choice-btn">Explore the Ancient Ruins</button>
        <button @onclick='() => MakeChoice("enchanted_bridge")' class="choice-btn">Find the Enchanted Bridge</button>
        <button @onclick='() => MakeChoice("mysterious_cave")' class="choice-btn">Enter the Mysterious Cave</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "climb_vines")
{
    <div>
        <h4>ğŸŒ¿ The Descent</h4>
        <p>You grab onto the thick vines and begin climbing down the cliff face. The vines are stronger than they look.</p>
        <p>Halfway down, you discover a hidden cave entrance! Inside, you can hear the sound of dripping waterâ€”and something else moving in the darkness.</p>
        <button @onclick='() => MakeChoice("enter_cave")' class="choice-btn">Explore the hidden cave</button>
        <button @onclick='() => MakeChoice("continue_down")' class="choice-btn">Continue climbing down</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "explore_ravine")
{
    <div>
        <h4>ğŸï¸ The Ravine's Edge</h4>
        <p>You walk along the ravine edge, looking for a safer passage. The path narrows dangerously, and loose rocks tumble into the depths below.</p>
        <p>Your foot slips! You try to grab onto something, but there's nothing to hold.</p>
        <p><strong>ğŸ’€ Game Over! You fell into the ravine.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "join_travelers")
{
    <div>
        <h4>ğŸ‘¥ Fellowship Found</h4>
        <p>You step out and greet the travelers warmly. They turn out to be experienced treasure hunters who have been searching these woods for months!</p>
        <p>They're impressed by your courage to venture alone and invite you to join their expedition. With their knowledge and your determination, you all work together.</p>
        <p>The group's combined skills lead you to a secret passage they'd been searching for. Inside, you find the legendary treasure!</p>
        <p><strong>ğŸ† Victory! Teamwork made the dream work!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "sneak_past")
{
    <div>
        <h4>ğŸ¤« Silent Steps</h4>
        <p>You crouch low and quietly move past the camp. You're almost clear when you step on a dry branchâ€”CRACK!</p>
        <p>The travelers hear you! "Hey, wait!" they call out. But you're already running. In your haste, you lose your bearings and get turned around in the forest.</p>
        <p>Hours later, you find yourself back at the stream, exhausted and no closer to the treasure.</p>
        <p><strong>ğŸ˜ Loss: You made it home safely but found nothing.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "observe_travelers")
{
    <div>
        <h4>ğŸ‘ï¸ Patient Observation</h4>
        <p>You stay hidden and watch the travelers. They're studying a map and discussing locations. You overhear them mention "the old oak tree with three trunks" as a landmark.</p>
        <p>After they pack up and leave in another direction, you remember seeing such a tree on your journey! You head toward it with renewed purpose.</p>
        <button @onclick='() => MakeChoice("three_trunk_oak")' class="choice-btn">Find the three-trunk oak tree</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "crystal_caves")
{
    <div>
        <h4>ğŸ’ Glittering Depths</h4>
        <p>You enter the Crystal Caves. The walls sparkle with thousands of embedded crystals, creating a breathtaking light show.</p>
        <p>Deep in the caves, you discover that the crystals form a natural compass, pointing toward strong magical sources. Following their guidance, you navigate to a hidden chamber containing the treasure!</p>
        <p><strong>ğŸ† Victory! The crystals lit your way to fortune!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "ancient_ruins")
{
    <div>
        <h4>ğŸ›ï¸ Forgotten Temple</h4>
        <p>You arrive at the Ancient Ruins. Crumbling stone pillars and moss-covered walls tell of a civilization long past.</p>
        <p>As you explore, you accidentally trigger a trap! Arrows shoot from the walls, and you barely dodge them. However, one grazes your arm, and you realize too late that they were poisoned.</p>
        <p><strong>ğŸ’€ Game Over! The ancient defenses still worked after all these years.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "enter_cave")
{
    <div>
        <h4>ğŸ¦‡ The Hidden Cave</h4>
        <p>You carefully enter the dark cave. Your eyes adjust, and you see ancient markings on the walls. This must be an old sanctuary!</p>
        <p>As you venture deeper, you find a small underground spring. Drinking from it clears your mind, and suddenly you can sense the treasure's location!</p>
        <p>You follow the sensation through a series of tunnels and emerge in a sacred grove where the treasure has been protected for centuries.</p>
        <p><strong>ğŸ† Victory! The sacred waters guided your path!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "continue_down")
{
    <div>
        <h4>â¬‡ï¸ The Long Climb</h4>
        <p>You decide not to explore the cave and continue your descent. The climb is exhausting, and by the time you reach the bottom, you're too tired to continue safely.</p>
        <p>You set up camp at the ravine floor for the night. In the morning, you realize you're deep in the ravine with no clear path to the treasure.</p>
        <p><strong>ğŸ˜ Loss: You survived but couldn't complete your quest.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "three_trunk_oak")
{
    <div>
        <h4>ğŸŒ³ The Legendary Oak</h4>
        <p>You find the massive oak tree with three trunks twisted together. At its base, you notice fresh digging marks.</p>
        <p>You dig carefully and discover a hidden entrance to an underground vault. Inside lies the treasure, along with a note: "To the one patient enough to listen and learn."</p>
        <p><strong>ğŸ† Victory! Your patience and observation paid off!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "mystical_glade")
{
    <div>
        <h4>âœ¨ The Mystical Glade</h4>
        <p>You stumble upon a beautiful glade where the air shimmers with magic. In the center stands a stone altar with three colored orbs: red, blue, and green.</p>
        <p>An ethereal voice whispers: "Choose wisely, for only one path leads to truth."</p>
        <button @onclick='() => MakeChoice("touch_red_orb")' class="choice-btn">Touch the red orb (warmth emanates from it)</button>
        <button @onclick='() => MakeChoice("touch_blue_orb")' class="choice-btn">Touch the blue orb (cool and calming)</button>
        <button @onclick='() => MakeChoice("touch_green_orb")' class="choice-btn">Touch the green orb (pulses with life)</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "touch_red_orb")
{
    <div>
        <h4>ğŸ”¥ Trial of Fire</h4>
        <p>The red orb blazes to life! A ring of fire surrounds you, testing your courage. You must walk through the flames to prove your worth.</p>
        <p>As you step forward bravely, the flames part around you, recognizing your courage. Beyond the flames, you find a chest containing the treasure!</p>
        <p><strong>ğŸ† Victory! Your courage was rewarded!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "touch_blue_orb")
{
    <div>
        <h4>â„ï¸ Trial of Wisdom</h4>
        <p>The blue orb glows softly. A spectral figure appears and asks: "What is more valuable than gold, more precious than gems, yet costs nothing to give?"</p>
        <button @onclick='() => MakeChoice("answer_love")' class="choice-btn">Love</button>
        <button @onclick='() => MakeChoice("answer_knowledge")' class="choice-btn">Knowledge</button>
        <button @onclick='() => MakeChoice("answer_time")' class="choice-btn">Time</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "touch_green_orb")
{
    <div>
        <h4>ğŸŒ¿ Trial of Nature</h4>
        <p>The green orb bursts with life energy! Vines sprout from the ground, creating a living maze. You must navigate using your connection to nature.</p>
        <p>You close your eyes and feel the life force of the plants, letting them guide you through the maze. They lead you to a secret grove where the treasure awaits!</p>
        <p><strong>ğŸ† Victory! Nature rewarded your harmony!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_love")
{
    <div>
        <h4>ğŸ’ Correct!</h4>
        <p>"Love," the figure smiles. "Indeed. You have a wise heart." The figure reveals a hidden path that leads directly to the treasure chamber.</p>
        <p><strong>ğŸ† Victory! A wise heart found the way!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_knowledge")
{
    <div>
        <h4>ğŸ“š Partial Truth</h4>
        <p>"Knowledge is valuable," the figure says, "but not the answer I seek." The figure fades, leaving you confused. You wander but never find the treasure.</p>
        <p><strong>ğŸ˜ Loss: Close, but wisdom requires more than knowledge.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_time")
{
    <div>
        <h4>â° Not Quite</h4>
        <p>"Time is precious," the figure nods, "but it is not freely givenâ€”it is spent." The riddle remains unsolved, and you must leave empty-handed.</p>
        <p><strong>ğŸ˜ Loss: The answer eluded you.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "enchanted_bridge")
{
    <div>
        <h4>ğŸŒ‰ The Enchanted Bridge</h4>
        <p>You come across an ornate bridge spanning a misty chasm. A troll guardian blocks your way, but he seems friendly.</p>
        <p>"Answer my questions three, and you may pass," he rumbles. "Fail, and you must turn back."</p>
        <button @onclick='() => MakeChoice("accept_troll_challenge")' class="choice-btn">Accept the challenge</button>
        <button @onclick='() => MakeChoice("attempt_troll_bribe")' class="choice-btn">Offer the troll a bribe</button>
        <button @onclick='() => MakeChoice("seek_alternate_route")' class="choice-btn">Look for another way around</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "accept_troll_challenge")
{
    <div>
        <h4>ğŸ² The Troll's Questions</h4>
        <p>The troll grins. "First question: What has hands but cannot clap?"</p>
        <button @onclick='() => MakeChoice("answer_clock")' class="choice-btn">A clock</button>
        <button @onclick='() => MakeChoice("answer_statue")' class="choice-btn">A statue</button>
        <button @onclick='() => MakeChoice("answer_gloves")' class="choice-btn">Gloves</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_clock")
{
    <div>
        <h4>âœ… Question One Passed!</h4>
        <p>"Correct!" the troll nods approvingly. "Second question: I have cities but no houses, forests but no trees, and water but no fish. What am I?"</p>
        <button @onclick='() => MakeChoice("answer_map")' class="choice-btn">A map</button>
        <button @onclick='() => MakeChoice("answer_painting")' class="choice-btn">A painting</button>
        <button @onclick='() => MakeChoice("answer_dream")' class="choice-btn">A dream</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_statue")
{
    <div>
        <h4>âŒ Wrong Answer</h4>
        <p>"Incorrect!" the troll shakes his head. "A statue has no hands at all. You must turn back." You're forced to find another path, but time runs out.</p>
        <p><strong>ğŸ˜ Loss: The riddle stumped you.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_gloves")
{
    <div>
        <h4>âŒ Not Right</h4>
        <p>"No, no," the troll chuckles. "Gloves aren't hands themselves! Try again next time." You must turn back disappointed.</p>
        <p><strong>ğŸ˜ Loss: Better luck next time.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_map")
{
    <div>
        <h4>âœ… Question Two Passed!</h4>
        <p>"Excellent!" the troll beams. "Final question: The more you take, the more you leave behind. What am I?"</p>
        <button @onclick='() => MakeChoice("answer_footsteps")' class="choice-btn">Footsteps</button>
        <button @onclick='() => MakeChoice("answer_memories")' class="choice-btn">Memories</button>
        <button @onclick='() => MakeChoice("answer_breath")' class="choice-btn">Breaths</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_painting")
{
    <div>
        <h4>âŒ Incorrect</h4>
        <p>"Not quite!" the troll says. "A painting doesn't really have cities. You failed the challenge." You must turn back.</p>
        <p><strong>ğŸ˜ Loss: The troll's test was too difficult.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_dream")
{
    <div>
        <h4>âŒ Not the Answer</h4>
        <p>"Interesting guess, but no," the troll shrugs. "Dreams don't have cities in that way. You must leave." Disappointed, you turn back.</p>
        <p><strong>ğŸ˜ Loss: The riddle defeated you.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_footsteps")
{
    <div>
        <h4>ğŸ‰ All Questions Answered!</h4>
        <p>"Perfect! You've answered all three correctly!" the troll steps aside. "You may cross, wise traveler."</p>
        <p>Across the bridge, you find the treasure waiting in a beautiful meadow, guarded by the troll all these years!</p>
        <p><strong>ğŸ† Victory! Your wit earned passage to the treasure!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_memories")
{
    <div>
        <h4>âŒ So Close</h4>
        <p>"Memories are poetic," the troll says, "but not the answer. The correct answer was footsteps!" He blocks your path.</p>
        <p><strong>ğŸ˜ Loss: You were so close to success.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "answer_breath")
{
    <div>
        <h4>âŒ Wrong Choice</h4>
        <p>"No," the troll sighs. "Breaths are taken but not left behind. The answer was footsteps!" You must turn back.</p>
        <p><strong>ğŸ˜ Loss: The final riddle stumped you.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "attempt_troll_bribe")
{
    <div>
        <h4>ğŸ’° The Bribe Attempt</h4>
        <p>You offer the troll your gold coins. He looks offended. "I am a guardian of honor, not a common thief! Leave now!"</p>
        <p>Ashamed, you retreat. You later learn the troll would have let you pass if you'd answered his riddles.</p>
        <p><strong>ğŸ˜ Loss: Attempting bribery was dishonorable.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "seek_alternate_route")
{
    <div>
        <h4>ğŸ” The Search</h4>
        <p>You spend hours searching for another route around the chasm. Eventually, you find a narrow ledge along the cliff face.</p>
        <button @onclick='() => MakeChoice("take_narrow_ledge")' class="choice-btn">Take the narrow ledge</button>
        <button @onclick='() => MakeChoice("give_up_search")' class="choice-btn">Give up and go back</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "take_narrow_ledge")
{
    <div>
        <h4>ğŸ§— The Risky Path</h4>
        <p>You carefully edge along the narrow ledge. One wrong move could mean a fatal fall. Your heart pounds as you inch forward.</p>
        <p>Suddenly, rocks crumble beneath your feet! You grab for a handhold but there's nothing to grip.</p>
        <p><strong>ğŸ’€ Game Over! The ledge was too dangerous.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "give_up_search")
{
    <div>
        <h4>ğŸš¶ Retreat</h4>
        <p>Exhausted from the search, you decide to give up and head home. Sometimes discretion is the better part of valor.</p>
        <p><strong>ğŸ˜ Loss: You couldn't find a way to the treasure.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "mysterious_cave")
{
    <div>
        <h4>ğŸ•³ï¸ The Mysterious Cave</h4>
        <p>You enter a dark cave. As your eyes adjust, you see glowing crystals embedded in the walls, illuminating ancient cave paintings.</p>
        <p>The paintings seem to tell a story about the treasure's location. You also hear water dripping deeper in the cave.</p>
        <button @onclick='() => MakeChoice("study_paintings")' class="choice-btn">Study the cave paintings carefully</button>
        <button @onclick='() => MakeChoice("follow_water_sound")' class="choice-btn">Follow the sound of dripping water</button>
        <button @onclick='() => MakeChoice("collect_crystals")' class="choice-btn">Collect some of the glowing crystals</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "study_paintings")
{
    <div>
        <h4>ğŸ¨ Ancient Wisdom</h4>
        <p>You carefully study the paintings. They show a path through the cave system, marked with specific crystal colors: blue, then green, then red.</p>
        <p>Following this pattern through the tunnels, you navigate safely to a hidden chamber where the treasure has been protected for centuries!</p>
        <p><strong>ğŸ† Victory! The ancient ones left you a map!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "follow_water_sound")
{
    <div>
        <h4>ğŸ’§ Underground River</h4>
        <p>You follow the dripping sound deeper into the cave. It leads you to an underground river. The current is strong, and you see something shiny in the water.</p>
        <button @onclick='() => MakeChoice("dive_for_shiny")' class="choice-btn">Dive in to grab the shiny object</button>
        <button @onclick='() => MakeChoice("follow_river_bank")' class="choice-btn">Follow the river bank</button>
        <hr />
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "collect_crystals")
{
    <div>
        <h4>ğŸ’ Greedy Choice</h4>
        <p>You start prying crystals from the walls. Suddenly, the cave begins to shake! Removing the crystals has destabilized the cave structure.</p>
        <p>Rocks fall from the ceiling and you barely escape with your life, but you're trapped far from the treasure.</p>
        <p><strong>ğŸ˜ Loss: Greed led to danger and failure.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "dive_for_shiny")
{
    <div>
        <h4>ğŸŒŠ Swept Away</h4>
        <p>You dive into the underground river, but the current is far stronger than you anticipated! The shiny object was just fool's gold.</p>
        <p>The river sweeps you through dark tunnels. By the time you escape, you're miles away from the treasure location.</p>
        <p><strong>ğŸ˜ Loss: The river's power was underestimated.</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}
else if (currentNode == "follow_river_bank")
{
    <div>
        <h4>ğŸï¸ The Safe Path</h4>
        <p>You wisely follow the river bank instead of diving in. The river leads you through a series of caves to a magnificent underground chamber.</p>
        <p>There, on an island in the middle of a clear pool, sits the treasure chest! A natural stone bridge provides safe access.</p>
        <p><strong>ğŸ† Victory! Patience and caution led you to fortune!</strong></p>
        <button @onclick="RestartGame" class="choice-btn">Play Again</button>
        <button @onclick="OnExit.InvokeAsync">Back to Menu</button>
    </div>
}

@code {
    [Parameter] public EventCallback OnExit { get; set; }

    private string currentNode = "start";

    private void MakeChoice(string nextNode)
    {
        string previousNode = currentNode;
        currentNode = nextNode;

        // Track game outcomes
        if (IsWinNode(nextNode))
        {
            Engine.AddWin();
        }
        else if (IsDeathNode(nextNode))
        {
            Engine.AddDeath();
        }
        else if (IsLossNode(nextNode))
        {
            Engine.AddLoss();
        }

        StateHasChanged();
    }

    private void RestartGame()
    {
        currentNode = "start";
        StateHasChanged();
    }

    private bool IsWinNode(string node)
    {
        return node == "buy_compass" || node == "befriend_wolf" || node == "swim_pond" || node == "uphill" 
            || node == "join_travelers" || node == "crystal_caves" || node == "enter_cave" 
            || node == "three_trunk_oak" || node == "rest_by_pond" || node == "follow_symbols"
            || node == "pay_hermit" || node == "behind_waterfall" || node == "answer_echo"
            || node == "touch_red_orb" || node == "touch_green_orb" || node == "answer_love"
            || node == "answer_footsteps" || node == "study_paintings" || node == "follow_river_bank";
    }

    private bool IsDeathNode(string node)
    {
        return node == "rob_merchant" || node == "fight_wolf" || node == "drink_water" 
            || node == "explore_ravine" || node == "ancient_ruins" || node == "dark_forest_ahead"
            || node == "take_narrow_ledge";
    }

    private bool IsLossNode(string node)
    {
        return node == "sneak_past" || node == "continue_down" || node == "ignore_symbols"
            || node == "decline_hermit" || node == "climb_waterfall" || node == "answer_wind" || node == "answer_voice"
            || node == "answer_knowledge" || node == "answer_time" || node == "answer_statue" || node == "answer_gloves"
            || node == "answer_painting" || node == "answer_dream" || node == "answer_memories" || node == "answer_breath"
            || node == "attempt_troll_bribe" || node == "give_up_search" || node == "collect_crystals" || node == "dive_for_shiny";
    }
}